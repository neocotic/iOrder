<!DOCTYPE html>

<html>
<head>
  <title>options.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="analytics.html">
                analytics.coffee
              </a>
            
              
              <a class="source" href="background.html">
                background.coffee
              </a>
            
              
              <a class="source" href="i18n.html">
                i18n.coffee
              </a>
            
              
              <a class="source" href="install.html">
                install.coffee
              </a>
            
              
              <a class="source" href="log.html">
                log.coffee
              </a>
            
              
              <a class="source" href="notification.html">
                notification.coffee
              </a>
            
              
              <a class="source" href="options.html">
                options.coffee
              </a>
            
              
              <a class="source" href="popup.html">
                popup.coffee
              </a>
            
              
              <a class="source" href="store.html">
                store.coffee
              </a>
            
              
              <a class="source" href="utils.html">
                utils.coffee
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>options.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p><a href="http://neocotic.com/iOrder">iOrder</a><br>(c) 2013 Alasdair Mercer<br>Freely distributable under the MIT license.<br>For all details and documentation:<br><a href="http://neocotic.com/iOrder">http://neocotic.com/iOrder</a></p>
<h2>Private constants</h2>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Regular expression used to sanitize search queries.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>R_CLEAN_QUERY = <span class="regexp">/[^\w\s]/g</span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Regular expression used to validate order keys.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>R_VALID_KEY   = <span class="regexp">/^[A-Z0-9]*\.[A-Z0-9]*$/i</span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Regular expression used to identify whitespace.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>R_WHITESPACE  = <span class="regexp">/\s+/</span></pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h2>Private variables</h2>

            </div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Copy of order being actively modified.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>activeOrder   = <span class="literal">null</span></pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Easily accessible reference to the extension controller.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>{ext}         = chrome.extension.getBackgroundPage()</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Indicate whether or not the user feedback feature has been added to the page.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>feedbackAdded = <span class="literal">no</span></pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Orders matching the current search query.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>searchResults = <span class="literal">null</span></pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <h2>Load functions</h2>

            </div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Bind an event of the specified <code>type</code> to the elements included by <code>selector</code> that, when
triggered, modifies the underlying <code>option</code> with the value returned by <code>evaluate</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">bindSaveEvent</span></span> = (selector, type, option, evaluate, callback) -&gt;
  log.trace()
  $(selector).<span class="literal">on</span> type, -&gt;
    $<span class="keyword">this</span> = $ <span class="keyword">this</span>
    key   = <span class="string">''</span>
    value = <span class="literal">null</span>
    store.modify option, (data) -&gt;
      key = $<span class="keyword">this</span>.attr(<span class="string">'id'</span>).match(<span class="keyword">new</span> RegExp(<span class="string">"^<span class="subst">#{option}</span>(\\S*)"</span>))[<span class="number">1</span>]
      key = key[<span class="number">0</span>].toLowerCase() + key.substr <span class="number">1</span>
      data[key] = value = evaluate.call $<span class="keyword">this</span>, key
    callback? $<span class="keyword">this</span>, key, value</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Update the options page with the values from the current settings.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">load</span></span> = -&gt;
  log.trace()
  $(<span class="string">'#analytics'</span>).prop <span class="string">'checked'</span>, store.get <span class="string">'analytics'</span>
  <span class="keyword">do</span> loadSaveEvents
  <span class="keyword">do</span> loadFrequencies
  <span class="keyword">do</span> loadOrders
  <span class="keyword">do</span> loadNotifications
  <span class="keyword">do</span> loadDeveloperTools</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Update the developer tools section of the options page with the current settings.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">loadDeveloperTools</span></span> = -&gt;
  log.trace()
  <span class="keyword">do</span> loadLogger</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Update the frequency section of the options page with the current settings.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">loadFrequencies</span></span> = -&gt;
  log.trace()
  frequency = $ <span class="string">'#frequency'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Start from a clean slate.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  frequency.remove <span class="string">'option'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Create and insert options representing each available update frequency.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">for</span> freq <span class="keyword">in</span> ext.config.frequencies
    option = $ <span class="string">'&lt;option/&gt;'</span>,
      text:  freq.text
      value: freq.value
    option.prop <span class="string">'selected'</span>, freq.value <span class="keyword">is</span> frequency
    frequency.append option
  <span class="keyword">do</span> loadFrequenciesSaveEvents</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Bind the event handlers required for persisting frequency changes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">loadFrequenciesSaveEvents</span></span> = -&gt;
  log.trace()
  $(<span class="string">'#frequency'</span>).<span class="literal">on</span> <span class="string">'change'</span>, -&gt;
    value = $(<span class="keyword">this</span>).val()
    log.debug <span class="string">"Changing frequency to '<span class="subst">#{value}</span>'"</span>
    store.set <span class="string">'frequency'</span>, parseInt frequency, <span class="number">10</span>
    ext.updateOrders()
    analytics.track <span class="string">'General'</span>, <span class="string">'Changed'</span>, <span class="string">'Frequency'</span>, value</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Update the logging section of the options page with the current settings.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">loadLogger</span></span> = -&gt;
  log.trace()
  logger = store.get <span class="string">'logger'</span>
  $(<span class="string">'#loggerEnabled'</span>).prop <span class="string">'checked'</span>, logger.enabled
  loggerLevel = $ <span class="string">'#loggerLevel'</span>
  loggerLevel.find(<span class="string">'option'</span>).remove()
  <span class="keyword">for</span> level <span class="keyword">in</span> log.LEVELS
    option = $ <span class="string">'&lt;option/&gt;'</span>,
      text:  i18n.get <span class="string">"opt_logger_level_<span class="subst">#{level.name}</span>_text"</span>
      value: level.value
    option.prop <span class="string">'selected'</span>, level.value <span class="keyword">is</span> logger.level
    loggerLevel.append option</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Ensure debug level is selected if configuration currently matches none.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">unless</span> loggerLevel.find(<span class="string">'option[selected]'</span>).length
    loggerLevel.find(<span class="string">"option[value='<span class="subst">#{log.DEBUG}</span>']"</span>).prop <span class="string">'selected'</span>, <span class="literal">yes</span>
  <span class="keyword">do</span> loadLoggerSaveEvents</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Bind the event handlers required for persisting logging changes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">loadLoggerSaveEvents</span></span> = -&gt;
  log.trace()
  bindSaveEvent <span class="string">'#loggerEnabled, #loggerLevel'</span>, <span class="string">'change'</span>, <span class="string">'logger'</span>, (key) -&gt;
    value = <span class="keyword">if</span> key <span class="keyword">is</span> <span class="string">'level'</span> <span class="keyword">then</span> <span class="property">@val</span>() <span class="keyword">else</span> <span class="property">@is</span> <span class="string">':checked'</span>
    log.debug <span class="string">"Changing logging <span class="subst">#{key}</span> to '<span class="subst">#{value}</span>'"</span>
    value
  , (jel, key, value) -&gt;
    logger = store.get <span class="string">'logger'</span>
    chrome.extension.getBackgroundPage().log.config = log.config = logger
    analytics.track <span class="string">'Logging'</span>, <span class="string">'Changed'</span>, key[<span class="number">0</span>].toUpperCase() + key.substr(<span class="number">1</span>), Number value</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Update the notification section of the options page with the current settings.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">loadNotifications</span></span> = -&gt;
  log.trace()
  {badges, duration, enabled} = store.get <span class="string">'notifications'</span>
  $(<span class="string">'#notificationsBadges'</span>).prop <span class="string">'checked'</span>, badges
  $(<span class="string">'#notificationsDuration'</span>).val <span class="keyword">if</span> duration &gt; <span class="number">0</span> <span class="keyword">then</span> duration * <span class="number">.001</span> <span class="keyword">else</span> <span class="number">0</span>
  $(<span class="string">'#notificationsEnabled'</span>).prop <span class="string">'checked'</span>, enabled
  <span class="keyword">do</span> loadNotificationSaveEvents</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Bind the event handlers required for persisting notification changes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">loadNotificationSaveEvents</span></span> = -&gt;
  log.trace()
  bindSaveEvent <span class="string">'#notificationsBadges, #notificationsDuration, #notificationsEnabled'</span>, <span class="string">'change'</span>,
    <span class="string">'notifications'</span>, (key) -&gt;
      value = <span class="keyword">if</span> key <span class="keyword">is</span> <span class="string">'duration'</span>
        milliseconds = <span class="property">@val</span>()
        <span class="keyword">if</span> milliseconds <span class="keyword">then</span> parseInt(milliseconds, <span class="number">10</span>) * <span class="number">1000</span> <span class="keyword">else</span> <span class="number">0</span>
      <span class="keyword">else</span>
        <span class="property">@is</span> <span class="string">':checked'</span>
      log.debug <span class="string">"Changing notifications <span class="subst">#{key}</span> to '<span class="subst">#{value}</span>'"</span>
      value
  , (jel, key, value) -&gt;
    analytics.track <span class="string">'Notifications'</span>, <span class="string">'Changed'</span>, key[<span class="number">0</span>].toUpperCase() + key.substr(<span class="number">1</span>), Number value</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Create a <code>tr</code> element representing the <code>order</code> provided.<br>The element returned should then be inserted in to the table that is displaying the orders.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">loadOrder</span></span> = (order) -&gt;
  log.trace()
  log.debug <span class="string">'Creating a row for the following order...'</span>, order
  row = $ <span class="string">'&lt;tr/&gt;'</span>, draggable: <span class="literal">yes</span>
  alignCenter = css: <span class="string">'text-align'</span>: <span class="string">'center'</span>
  row.append $(<span class="string">'&lt;td/&gt;'</span>, alignCenter).append $ <span class="string">'&lt;input/&gt;'</span>,
    title: i18n.get <span class="string">'opt_select_box'</span>
    type:  <span class="string">'checkbox'</span>
    value: order.key
  row.append $(<span class="string">'&lt;td/&gt;'</span>).append $ <span class="string">'&lt;span/&gt;'</span>,
    text:  order.label
    title: i18n.get <span class="string">'opt_order_modify_title'</span>, order.label
  row.append $(<span class="string">'&lt;td/&gt;'</span>).append $(<span class="string">'&lt;span/&gt;'</span>).append $ <span class="string">'&lt;a/&gt;'</span>,
    href:   ext.getOrderUrl order
    target: <span class="string">'_blank'</span>
    text:   order.number
    title:  i18n.get <span class="string">'opt_order_title'</span>
  row.append $(<span class="string">'&lt;td/&gt;'</span>).append $ <span class="string">'&lt;span/&gt;'</span>, text: order.code
  row.append $(<span class="string">'&lt;td/&gt;'</span>).append $ <span class="string">'&lt;span/&gt;'</span>, text: ext.getStatusText order
  row.append $(<span class="string">'&lt;td/&gt;'</span>).append <span class="keyword">if</span> order.trackingUrl
    $ <span class="string">'&lt;a/&gt;'</span>,
      href:   order.trackingUrl
      target: <span class="string">'_blank'</span>
      text:   i18n.get <span class="string">'opt_track_text'</span>
      title:  i18n.get <span class="string">'opt_track_title'</span>
  <span class="keyword">else</span>
    <span class="string">'&amp;nbsp;'</span>
  row.append $(<span class="string">'&lt;td/&gt;'</span>).append $ <span class="string">'&lt;span/&gt;'</span>,
    class: <span class="string">'muted'</span>
    text:  <span class="string">'::::'</span>
    title: i18n.get <span class="string">'opt_order_move_title'</span>, order.label
  row</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Bind the event handlers required for controlling the orders.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">loadOrderControlEvents</span></span> = -&gt;
  log.trace()</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Ensure order wizard is closed if/when tabify links are clicked within it or it is cancelled.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  $(<span class="string">'#order_wizard [tabify], #order_cancel_btn'</span>).<span class="literal">on</span> <span class="string">'click'</span>, -&gt;
    <span class="keyword">do</span> closeWizard
  $(<span class="string">'#order_reset_btn'</span>).<span class="literal">on</span> <span class="string">'click'</span>, -&gt;
    <span class="keyword">do</span> resetWizard</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Support search functionality for orders.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  filter = $ <span class="string">'#order_filter'</span>
  filter.find(<span class="string">'option'</span>).remove()
  <span class="keyword">for</span> limit <span class="keyword">in</span> ext.config.options.limits
    filter.append $ <span class="string">'&lt;option/&gt;'</span>, text: limit
  filter.append $ <span class="string">'&lt;option/&gt;'</span>,
    disabled: <span class="string">'disabled'</span>
    text:     <span class="string">'-----'</span>
  filter.append $ <span class="string">'&lt;option/&gt;'</span>,
    text:  i18n.get <span class="string">'opt_show_all_text'</span>
    value: <span class="number">0</span>
  store.init <span class="string">'options_limit'</span>, parseInt $(<span class="string">'#order_filter'</span>).val(), <span class="number">10</span>
  limit = store.get <span class="string">'options_limit'</span>
  $(<span class="string">'#order_filter option'</span>).each -&gt;
    $<span class="keyword">this</span> = $ <span class="keyword">this</span>
    $<span class="keyword">this</span>.prop <span class="string">'selected'</span>, limit <span class="keyword">is</span> parseInt $<span class="keyword">this</span>.val(), <span class="number">10</span>
  $(<span class="string">'#order_filter'</span>).<span class="literal">on</span> <span class="string">'change'</span>, -&gt;
    store.set <span class="string">'options_limit'</span>, parseInt $(<span class="keyword">this</span>).val(), <span class="number">10</span>
    loadOrderRows searchResults ? ext.orders
  $(<span class="string">'#order_search :reset'</span>).<span class="literal">on</span> <span class="string">'click'</span>, -&gt;
    $(<span class="string">'#order_search :text'</span>).val <span class="string">''</span>
    <span class="keyword">do</span> searchOrders
  $(<span class="string">'#order_controls'</span>).<span class="literal">on</span> <span class="string">'submit'</span>, -&gt;
    searchOrders $(<span class="string">'#order_search :text'</span>).val()</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Ensure user confirms deletion of order.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  $(<span class="string">'#order_delete_btn'</span>).<span class="literal">on</span> <span class="string">'click'</span>, -&gt;
    $(<span class="keyword">this</span>).hide()
    $(<span class="string">'#order_confirm_delete'</span>).css <span class="string">'display'</span>, <span class="string">'inline-block'</span>
  $(<span class="string">'#order_undo_delete_btn'</span>).<span class="literal">on</span> <span class="string">'click'</span>, -&gt;
    $(<span class="string">'#order_confirm_delete'</span>).hide()
    $(<span class="string">'#order_delete_btn'</span>).show()
  $(<span class="string">'#order_confirm_delete_btn'</span>).<span class="literal">on</span> <span class="string">'click'</span>, -&gt;
    $(<span class="string">'#order_confirm_delete'</span>).hide()
    $(<span class="string">'#order_delete_btn'</span>).show()
    deleteOrders [activeOrder]
    <span class="keyword">do</span> closeWizard
  validationErrors = []
  $(<span class="string">'#order_wizard'</span>).<span class="literal">on</span> <span class="string">'hide'</span>, -&gt;
    error.hide() <span class="keyword">for</span> error <span class="keyword">in</span> validationErrors
  $(<span class="string">'#order_save_btn'</span>).<span class="literal">on</span> <span class="string">'click'</span>, -&gt;
    order = deriveOrder()</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Clear all existing validation errors.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    error.hide() <span class="keyword">for</span> error <span class="keyword">in</span> validationErrors
    validationErrors = validateOrder order
    <span class="keyword">if</span> validationErrors.length
      error.show() <span class="keyword">for</span> error <span class="keyword">in</span> validationErrors
    <span class="keyword">else</span>
      validationErrors = []
      $.extend activeOrder, order
      saveOrder activeOrder
      $(<span class="string">'#order_search :reset'</span>).hide()
      $(<span class="string">'#order_search :text'</span>).val <span class="string">''</span>
      <span class="keyword">do</span> closeWizard</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Open the order wizard without any context.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  $(<span class="string">'#add_btn'</span>).<span class="literal">on</span> <span class="string">'click'</span>, -&gt;
    openWizard <span class="literal">null</span>
  selectedOrders = []
  $(<span class="string">'#delete_wizard'</span>).<span class="literal">on</span> <span class="string">'hide'</span>, -&gt;
      selectedOrders = []
      $(<span class="string">'#delete_items li'</span>).remove()</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Prompt the user to confirm removal of the selected order(s).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  $(<span class="string">'#delete_btn'</span>).<span class="literal">on</span> <span class="string">'click'</span>, -&gt;
    deleteItems    = $ <span class="string">'#delete_items'</span>
    selectedOrders = getSelectedOrders()
    deleteItems.find(<span class="string">'li'</span>).remove()</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Create list items for each order and allocate them accordingly.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">for</span> order <span class="keyword">in</span> selectedOrders
      deleteItems.append $ <span class="string">'&lt;li/&gt;'</span>, text: <span class="string">"<span class="subst">#{order.label}</span> (<span class="subst">#{order.number}</span>)"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Begin the order removal process by showing the dialog.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $(<span class="string">'#delete_wizard'</span>).modal <span class="string">'show'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Cancel the order removal process.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  $(<span class="string">'#delete_cancel_btn, #delete_no_btn'</span>).<span class="literal">on</span> <span class="string">'click'</span>, -&gt;
    $(<span class="string">'#delete_wizard'</span>).modal <span class="string">'hide'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Finalize the order removal process.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  $(<span class="string">'#delete_yes_btn'</span>).<span class="literal">on</span> <span class="string">'click'</span>, -&gt;
    deleteOrders selectedOrders
    $(<span class="string">'#delete_wizard'</span>).modal <span class="string">'hide'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Load the <code>orders</code> into the table to be displayed to the user.<br>Optionally, pagination can be disabled but this should only really be used internally by the
pagination process.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">loadOrderRows</span></span> = (orders = ext.orders, pagination = <span class="literal">yes</span>) -&gt;
  log.trace()
  table = $ <span class="string">'#orders'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Start from a clean slate.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  table.find(<span class="string">'tbody tr'</span>).remove()
  <span class="keyword">if</span> orders.length</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Create and insert rows representing each order.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    table.append loadOrder order <span class="keyword">for</span> order <span class="keyword">in</span> orders
    paginate orders <span class="keyword">if</span> pagination
    activateTooltips table
    <span class="keyword">do</span> activateDraggables
    <span class="keyword">do</span> activateModifications
    <span class="keyword">do</span> activateSelections
  <span class="keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Show single row to indicate no orders were found.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    table.find(<span class="string">'tbody'</span>).append $(<span class="string">'&lt;tr/&gt;'</span>).append $ <span class="string">'&lt;td/&gt;'</span>,
      colspan: table.find(<span class="string">'thead th'</span>).length
      html:    i18n.get <span class="string">'opt_no_orders_found_text'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Update the orders section of the options page with the current settings.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">loadOrders</span></span> = -&gt;
  log.trace()</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Load all of the event handlers required for managing the orders.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">do</span> loadOrderControlEvents</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Load the order data into the table.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">do</span> loadOrderRows</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Bind the event handlers required for persisting general changes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">loadSaveEvents</span></span> = -&gt;
  log.trace()
  $(<span class="string">'#analytics'</span>).<span class="literal">on</span> <span class="string">'change'</span>, -&gt;
    enabled = $(<span class="keyword">this</span>).<span class="keyword">is</span> <span class="string">':checked'</span>
    log.debug <span class="string">"Changing analytics to '<span class="subst">#{enabled}</span>'"</span>
    <span class="keyword">if</span> enabled
      store.set <span class="string">'analytics'</span>, <span class="literal">yes</span>
      chrome.extension.getBackgroundPage().analytics.add()
      analytics.add()
      analytics.track <span class="string">'General'</span>, <span class="string">'Changed'</span>, <span class="string">'Analytics'</span>, <span class="number">1</span>
    <span class="keyword">else</span>
      analytics.track <span class="string">'General'</span>, <span class="string">'Changed'</span>, <span class="string">'Analytics'</span>, <span class="number">0</span>
      analytics.remove()
      chrome.extension.getBackgroundPage().analytics.remove()
      store.set <span class="string">'analytics'</span>, <span class="literal">no</span></pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <h2>Save functions</h2>

            </div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Delete all of the <code>orders</code> provided.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">deleteOrders</span></span> = (orders) -&gt;
  log.trace()
  keys = (order.key <span class="keyword">for</span> order <span class="keyword">in</span> orders)
  <span class="keyword">if</span> keys.length
    keep = []
    <span class="keyword">for</span> order, i <span class="keyword">in</span> ext.orders <span class="keyword">when</span> order.key <span class="keyword">not</span> <span class="keyword">in</span> keys
      orders.index = i
      keep.push order
    store.set <span class="string">'orders'</span>, keep
    ext.updateOrders()
    <span class="keyword">if</span> keys.length &gt; <span class="number">1</span>
      log.debug <span class="string">"Deleted <span class="subst">#{keys.length}</span> orders"</span>
      analytics.track <span class="string">'Orders'</span>, <span class="string">'Deleted'</span>, <span class="string">"Count[<span class="subst">#{keys.length}</span>]"</span>
    <span class="keyword">else</span>
      order = orders[<span class="number">0</span>]
      log.debug <span class="string">"Deleted <span class="subst">#{order.label}</span> order"</span>
      analytics.track <span class="string">'Orders'</span>, <span class="string">'Deleted'</span>, order.label
    loadOrderRows searchResults ? ext.orders</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Reorder the orders after a drag and drop <em>swap</em> by updating their indices and sorting them
accordingly.<br>These changes are then persisted and should be reflected throughout the extension.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">reorderOrders</span></span> = (fromIndex, toIndex) -&gt;
  log.trace()
  orders = ext.orders
  <span class="keyword">if</span> fromIndex? <span class="keyword">and</span> toIndex?
    orders[fromIndex].index = toIndex
    orders[toIndex].index   = fromIndex
  store.set <span class="string">'orders'</span>, orders
  ext.updateOrders()</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Update and persist the <code>order</code> provided.<br>Any required validation should be performed perior to calling this method.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">saveOrder</span></span> = (order) -&gt;
  log.trace()
  log.debug <span class="string">'Saving the following order...'</span>, order
  isNew  = <span class="keyword">not</span> order.key?
  orders = store.get <span class="string">'orders'</span>
  <span class="keyword">if</span> isNew
    order.key = utils.keyGen()
    orders.push order
  <span class="keyword">else</span>
    <span class="keyword">for</span> temp, i <span class="keyword">in</span> orders <span class="keyword">when</span> temp.key <span class="keyword">is</span> order.key
      orders[i] = order
      <span class="keyword">break</span>
  store.set <span class="string">'orders'</span>, orders
  ext.updateOrders()
  <span class="keyword">do</span> loadOrderRows
  action = <span class="keyword">if</span> isNew <span class="keyword">then</span> <span class="string">'Added'</span> <span class="keyword">else</span> <span class="string">'Saved'</span>
  analytics.track <span class="string">'Orders'</span>, action, order.label
  order</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <h2>Validation classes</h2>

            </div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p><code>ValidationError</code> allows easy management and display of validation error messages that are
associated with specific fields.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="class"><span class="keyword">class</span> <span class="title">ValidationError</span> <span class="keyword">extends</span> <span class="title">utils</span>.<span class="title">Class</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Create a new instance of <code>ValidationError</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  constructor: (<span class="property">@id</span>, <span class="property">@key</span>) -&gt;
    <span class="property">@className</span> = <span class="string">'error'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Hide any validation messages currently displayed for the associated field.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  hide: -&gt;
    field = $ <span class="string">"#<span class="subst">#{@id}</span>"</span>
    field.parents(<span class="string">'.control-group:first'</span>).removeClass <span class="property">@className</span>
    field.parents(<span class="string">'.controls:first'</span>).find(<span class="string">'.help-block'</span>).remove()</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Display the validation message for the associated field.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  show: -&gt;
    field = $ <span class="string">"#<span class="subst">#{@id}</span>"</span>
    field.parents(<span class="string">'.control-group:first'</span>).addClass <span class="property">@className</span>
    field.parents(<span class="string">'.controls:first'</span>).append $ <span class="string">'&lt;span/&gt;'</span>,
      class: <span class="string">'help-block'</span>
      html:  i18n.get <span class="property">@key</span></pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p><code>ValidationWarning</code> allows easy management and display of validation warning messages that are
associated with specific fields.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="class"><span class="keyword">class</span> <span class="title">ValidationWarning</span> <span class="keyword">extends</span> <span class="title">ValidationError</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Create a new instance of <code>ValidationWarning</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  constructor: (<span class="property">@id</span>, <span class="property">@key</span>) -&gt;
    <span class="property">@className</span> = <span class="string">'warning'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <h2>Validation functions</h2>

            </div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>Indicate whether or not the specified <code>key</code> is valid.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">isKeyValid</span></span> = (key) -&gt;
  log.trace()
  log.debug <span class="string">"Validating order key '<span class="subst">#{key}</span>'"</span>
  R_VALID_KEY.test key</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>Determine whether or not an order already exists with the specified <code>number</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">isNumberAvailable</span></span> = (number) -&gt;
  log.trace()
  log.debug <span class="string">"Validating order number '<span class="subst">#{number}</span>'"</span>
  <span class="keyword">not</span> ext.queryOrder (order) -&gt; order.number <span class="keyword">is</span> number</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>Validate the <code>order</code> and return any validation errors/warnings that were encountered.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">validateOrder</span></span> = (order) -&gt;
  log.trace()
  isNew  = <span class="keyword">not</span> order.key?
  errors = []
  log.debug <span class="string">'Validating the following order...'</span>, order</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>Label is missing but is required.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">unless</span> order.label
    errors.push <span class="keyword">new</span> ValidationError <span class="string">'order_label'</span>, <span class="string">'opt_order_label_invalid'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>Number is missing but is required.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">unless</span> order.number
    errors.push <span class="keyword">new</span> ValidationError <span class="string">'order_number'</span>, <span class="string">'opt_order_number_invalid'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>Number already exists.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">unless</span> isNumberAvailable order.number
    errors.push <span class="keyword">new</span> ValidationError <span class="string">'order_number'</span>, <span class="string">'opt_order_number_unavailable'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>Zip/post code is missing but is required.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">unless</span> order.code
    errors.push <span class="keyword">new</span> ValidationError <span class="string">'order_code'</span>, <span class="string">'opt_order_code_invalid'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>Indicate whether or not any validation errors were encountered.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  log.debug <span class="string">'Following validation errors were found...'</span>, errors
  errors</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <h2>Miscellaneous classes</h2>

            </div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p><code>Message</code> allows simple management and display of alert messages.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="class"><span class="keyword">class</span> <span class="title">Message</span> <span class="keyword">extends</span> <span class="title">utils</span>.<span class="title">Class</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>Create a new instance of <code>Message</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  constructor: (<span class="property">@block</span>) -&gt;
    <span class="property">@className</span> = <span class="string">'alert-info'</span>
    <span class="property">@headerKey</span> = <span class="string">'opt_message_header'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>Hide this <code>Message</code> if it has previously been displayed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  hide: -&gt; <span class="property">@alert</span>?.alert <span class="string">'close'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>Display this <code>Message</code> at the top of the current tab.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  show: -&gt;
    <span class="property">@header</span>  = i18n.get <span class="property">@headerKey</span> <span class="keyword">if</span> <span class="property">@headerKey</span> <span class="keyword">and</span> <span class="keyword">not</span> <span class="property">@header</span>?
    <span class="property">@message</span> = i18n.get <span class="property">@messageKey</span> <span class="keyword">if</span> <span class="property">@messageKey</span> <span class="keyword">and</span> <span class="keyword">not</span> <span class="property">@message</span>?
    <span class="property">@alert</span>   = $ <span class="string">'&lt;div/&gt;'</span>, class: <span class="string">"alert <span class="subst">#{@className}</span>"</span>
    <span class="property">@alert</span>.addClass <span class="string">'alert-block'</span> <span class="keyword">if</span> <span class="property">@block</span>
    <span class="property">@alert</span>.append $ <span class="string">'&lt;button/&gt;'</span>,
      class:          <span class="string">'close'</span>
      <span class="string">'data-dismiss'</span>: <span class="string">'alert'</span>
      html:           <span class="string">'&amp;times;'</span>
      type:           <span class="string">'button'</span>
    <span class="property">@alert</span>.append $ <span class="string">"&lt;<span class="subst">#{<span class="keyword">if</span> @block <span class="keyword">then</span> 'h4' <span class="keyword">else</span> 'strong'}</span>/&gt;"</span>, html: <span class="property">@header</span> <span class="keyword">if</span> <span class="property">@header</span>
    <span class="property">@alert</span>.append <span class="keyword">if</span> <span class="property">@block</span> <span class="keyword">then</span> <span class="property">@message</span> <span class="keyword">else</span> <span class="string">" <span class="subst">#{@message}</span>"</span> <span class="keyword">if</span> <span class="property">@message</span>
    <span class="property">@alert</span>.prependTo $ $(<span class="string">'#navigation li.active a'</span>).attr <span class="string">'tabify'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p><code>ErrorMessage</code> allows simple management and display of error messages.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="class"><span class="keyword">class</span> <span class="title">ErrorMessage</span> <span class="keyword">extends</span> <span class="title">Message</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>Create a new instance of <code>ErrorMessage</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  constructor: (<span class="property">@block</span>) -&gt;
    <span class="property">@className</span> = <span class="string">'alert-error'</span>
    <span class="property">@headerKey</span> = <span class="string">'opt_message_error_header'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p><code>SuccessMessage</code> allows simple management and display of success messages.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="class"><span class="keyword">class</span> <span class="title">SuccessMessage</span> <span class="keyword">extends</span> <span class="title">Message</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>Create a new instance of <code>SuccessMessage</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  constructor: (<span class="property">@block</span>) -&gt;
    <span class="property">@className</span> = <span class="string">'alert-success'</span>
    <span class="property">@headerKey</span> = <span class="string">'opt_message_success_header'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p><code>WarningMessage</code> allows simple management and display of warning messages.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="class"><span class="keyword">class</span> <span class="title">WarningMessage</span> <span class="keyword">extends</span> <span class="title">Message</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>Create a new instance of <code>WarningMessage</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  constructor: (<span class="property">@block</span>) -&gt;
    <span class="property">@className</span> = <span class="string">''</span>
    <span class="property">@headerKey</span> = <span class="string">'opt_message_warning_header'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <h2>Miscellaneous functions</h2>

            </div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>Activate drag and drop functionality for reordering orders.<br>The activation is done cleanly, unbinding any associated events that have been previously bound.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">activateDraggables</span></span> = -&gt;
  log.trace()
  table      = $ <span class="string">'#orders'</span>
  dragSource = <span class="literal">null</span>
  draggables = table.find <span class="string">'[draggable]'</span>
  draggables.<span class="literal">off</span> <span class="string">'dragstart dragend dragenter dragover drop'</span>
  draggables.<span class="literal">on</span> <span class="string">'dragstart'</span>, (e) -&gt;
    $<span class="keyword">this</span>      = $ <span class="keyword">this</span>
    dragSource = <span class="keyword">this</span>
    table.removeClass <span class="string">'table-hover'</span>
    $<span class="keyword">this</span>.addClass <span class="string">'dnd-moving'</span>
    $<span class="keyword">this</span>.find(<span class="string">'[data-original-title]'</span>).tooltip <span class="string">'hide'</span>
    e.originalEvent.dataTransfer.effectAllowed = <span class="string">'move'</span>
    e.originalEvent.dataTransfer.setData <span class="string">'text/html'</span>, $<span class="keyword">this</span>.html()
  draggables.<span class="literal">on</span> <span class="string">'dragend'</span>, (e) -&gt;
    draggables.removeClass <span class="string">'dnd-moving dnd-over'</span>
    table.addClass <span class="string">'table-hover'</span>
    dragSource = <span class="literal">null</span>
  draggables.<span class="literal">on</span> <span class="string">'dragenter'</span>, (e) -&gt;
    $<span class="keyword">this</span> = $ <span class="keyword">this</span>
    draggables.<span class="keyword">not</span>($<span class="keyword">this</span>).removeClass <span class="string">'dnd-over'</span>
    $<span class="keyword">this</span>.addClass <span class="string">'dnd-over'</span>
  draggables.<span class="literal">on</span> <span class="string">'dragover'</span>, (e) -&gt;
    e.preventDefault()
    e.originalEvent.dataTransfer.dropEffect = <span class="string">'move'</span>
    <span class="literal">no</span>
  draggables.<span class="literal">on</span> <span class="string">'drop'</span>, (e) -&gt;
    $dragSource = $ dragSource
    e.stopPropagation()
    <span class="keyword">if</span> dragSource <span class="keyword">isnt</span> <span class="keyword">this</span>
      $<span class="keyword">this</span> = $ <span class="keyword">this</span>
      $dragSource.html $<span class="keyword">this</span>.html()
      $<span class="keyword">this</span>.html e.originalEvent.dataTransfer.getData <span class="string">'text/html'</span>
      activateTooltips table
      <span class="keyword">do</span> activateModifications
      <span class="keyword">do</span> activateSelections
      fromIndex = $dragSource.index()
      toIndex   = $<span class="keyword">this</span>.index()
      <span class="keyword">if</span> searchResults?
        fromIndex = searchResults[fromIndex].index
        toIndex   = searchResults[toIndex].index
      reorderOrders fromIndex, toIndex
    <span class="literal">no</span></pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>Activate functionality to open order wizard when a row is clicked.<br>The activation is done cleanly, unbinding any associated events that have been previously bound.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">activateModifications</span></span> = -&gt;
  log.trace()
  $(<span class="string">'#orders tbody tr td:not(:first-child)'</span>).<span class="literal">off</span>(<span class="string">'click'</span>).<span class="literal">on</span> <span class="string">'click'</span>, -&gt;
    activeKey = $(<span class="keyword">this</span>).parents(<span class="string">'tr:first'</span>).find(<span class="string">':checkbox'</span>).val()
    openWizard ext.queryOrder (order) -&gt; order.key <span class="keyword">is</span> activeKey</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>Activate select all/one functionality on the orders table.<br>The activation is done cleanly, unbinding any associated events that have been previously bound.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">activateSelections</span></span> = -&gt;
  log.trace()
  table       = $ <span class="string">'#orders'</span>
  selectBoxes = table.find <span class="string">'tbody :checkbox'</span>
  selectBoxes.<span class="literal">off</span>(<span class="string">'change'</span>).<span class="literal">on</span> <span class="string">'change'</span>, -&gt;
    $<span class="keyword">this</span>       = $ <span class="keyword">this</span>
    messageKey  = <span class="string">'opt_select_box'</span>
    messageKey += <span class="string">'_checked'</span> <span class="keyword">if</span> $<span class="keyword">this</span>.<span class="keyword">is</span> <span class="string">':checked'</span>
    $<span class="keyword">this</span>.attr <span class="string">'data-original-title'</span>, i18n.get messageKey
    <span class="keyword">do</span> refreshSelectButtons
  table.find(<span class="string">'thead :checkbox'</span>).<span class="literal">off</span>(<span class="string">'change'</span>).<span class="literal">on</span> <span class="string">'change'</span>, -&gt;
    $<span class="keyword">this</span>       = $ <span class="keyword">this</span>
    checked     = $<span class="keyword">this</span>.<span class="keyword">is</span> <span class="string">':checked'</span>
    messageKey  = <span class="string">'opt_select_all_box'</span>
    messageKey += <span class="string">'_checked'</span> <span class="keyword">if</span> checked
    $<span class="keyword">this</span>.attr <span class="string">'data-original-title'</span>, i18n.get messageKey
    selectBoxes.prop <span class="string">'checked'</span>, checked
    <span class="keyword">do</span> refreshSelectButtons</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>Activate tooltip effects, optionally only within a specific context.<br>The activation is done cleanly, unbinding any associated events that have been previously bound.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">activateTooltips</span></span> = (selector) -&gt;
  log.trace()
  base = $ selector <span class="keyword">or</span> document
  base.find(<span class="string">'[data-original-title]'</span>).each -&gt;
    $<span class="keyword">this</span> = $ <span class="keyword">this</span>
    $<span class="keyword">this</span>.tooltip <span class="string">'destroy'</span>
    $<span class="keyword">this</span>.attr <span class="string">'title'</span>, $<span class="keyword">this</span>.attr <span class="string">'data-original-title'</span>
    $<span class="keyword">this</span>.removeAttr <span class="string">'data-original-title'</span>
  base.find(<span class="string">'[title]'</span>).each -&gt;
    $<span class="keyword">this</span>     = $ <span class="keyword">this</span>
    placement = $<span class="keyword">this</span>.attr <span class="string">'data-placement'</span>
    placement = <span class="keyword">if</span> placement? <span class="keyword">then</span> trimToLower placement <span class="keyword">else</span> <span class="string">'top'</span>
    $<span class="keyword">this</span>.tooltip
      container: $<span class="keyword">this</span>.attr(<span class="string">'data-container'</span>) ? <span class="string">'body'</span>
      placement: placement</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>Convenient shorthand for setting the current context to <code>null</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">clearContext</span></span> = -&gt;
  <span class="keyword">do</span> setContext</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>Clear the current context and close the order wizard.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">closeWizard</span></span> = -&gt;
  <span class="keyword">do</span> clearContext
  $(<span class="string">'#order_wizard'</span>).modal <span class="string">'hide'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>Create a order based on the current context and the information derived from the wizard fields.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">deriveOrder</span></span> = -&gt;
  log.trace()
  order =
    code:        $(<span class="string">'#order_code'</span>).val().trim()
    label:       $(<span class="string">'#order_label'</span>).val().trim()
    number:      $(<span class="string">'#order_number'</span>).val().trim()
    error:       activeOrder.error ? <span class="string">''</span>
    index:       activeOrder.index ? ext.orders.length
    key:         activeOrder.key
    trackingUrl: activeOrder.trackingUrl ? <span class="string">''</span>
    updates:     activeOrder.updates ? []
  log.debug <span class="string">'Following order was derived...'</span>, order
  order</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>Add the user feedback feature to the page.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">feedback</span></span> = -&gt;
  log.trace()
  <span class="keyword">unless</span> feedbackAdded</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>Continue with normal process of loading Widget.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    uv       = document.createElement <span class="string">'script'</span>
    uv.async = <span class="string">'async'</span>
    uv.src   = <span class="string">"https://widget.uservoice.com/<span class="subst">#{ext.config.options.userVoice.id}</span>.js"</span>
    script = document.getElementsByTagName(<span class="string">'script'</span>)[<span class="number">0</span>]
    script.parentNode.insertBefore uv, script</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>Configure the widget as it&#39;s loading.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    UserVoice = window.UserVoice <span class="keyword">or</span>= []
    UserVoice.push [
      <span class="string">'showTab'</span>
      <span class="string">'classic_widget'</span>
      {
        mode:          <span class="string">'full'</span>
        primary_color: <span class="string">'#333'</span>
        link_color:    <span class="string">'#08c'</span>
        default_mode:  <span class="string">'feedback'</span>
        forum_id:      ext.config.options.userVoice.forum
        tab_label:     i18n.get <span class="string">'opt_feedback_button'</span>
        tab_color:     <span class="string">'#333'</span>
        tab_position:  <span class="string">'middle-left'</span>
        tab_inverted:  <span class="literal">yes</span>
      }
    ]
    feedbackAdded = <span class="literal">yes</span></pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <p>Retrieve all currently selected orders.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">getSelectedOrders</span></span> = -&gt;
  selectedKeys = []
  $(<span class="string">'#orders tbody :checkbox:checked'</span>).each -&gt;
    selectedKeys.push $(<span class="keyword">this</span>).val()
  ext.queryOrders (order) -&gt; order.key <span class="keyword">in</span> selectedKeys</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <p>Open the order wizard after optionally setting the current context.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">openWizard</span></span> = (order) -&gt;
  setContext order <span class="keyword">if</span> arguments.length
  $(<span class="string">'#order_wizard'</span>).modal <span class="string">'show'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>Update the pagination UI for the specified <code>orders</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">paginate</span></span> = (orders) -&gt;
  log.trace()
  limit      = parseInt $(<span class="string">'#order_filter'</span>).val(), <span class="number">10</span>
  pagination = $ <span class="string">'#pagination'</span>
  <span class="keyword">if</span> orders.length &gt; limit &gt; <span class="number">0</span>
    children = pagination.find <span class="string">'ul li'</span>
    pages    = Math.ceil orders.length / limit</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <p>Refresh the pagination link states based on the new <code>page</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="function"><span class="title">refreshPagination</span></span> = (page = <span class="number">1</span>) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <p>Select and display the desired orders subset.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      start = limit * (page - <span class="number">1</span>)
      end   = start + limit
      loadOrderRows orders[start...end], <span class="literal">no</span></pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <p>Ensure the <em>previous</em> link is only enabled when a previous page exists.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      pagination.find(<span class="string">'ul li:first-child'</span>).each -&gt;
        $<span class="keyword">this</span> = $ <span class="keyword">this</span>
        <span class="keyword">if</span> page <span class="keyword">is</span> <span class="number">1</span> <span class="keyword">then</span> $<span class="keyword">this</span>.addClass <span class="string">'disabled'</span>
        <span class="keyword">else</span> $<span class="keyword">this</span>.removeClass <span class="string">'disabled'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <p>Ensure only the active page is highlighted.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      pagination.find(<span class="string">'ul li:not(:first-child, :last-child)'</span>).each -&gt;
        $<span class="keyword">this</span> = $ <span class="keyword">this</span>
        <span class="keyword">if</span> page <span class="keyword">is</span> parseInt $<span class="keyword">this</span>.text(), <span class="number">10</span> <span class="keyword">then</span> $<span class="keyword">this</span>.addClass <span class="string">'active'</span>
        <span class="keyword">else</span> $<span class="keyword">this</span>.removeClass <span class="string">'active'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <p>Ensure the <em>next</em> link is only enabled when a next page exists.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      pagination.find(<span class="string">'ul li:last-child'</span>).each -&gt;
        $<span class="keyword">this</span> = $ <span class="keyword">this</span>
        <span class="keyword">if</span> page <span class="keyword">is</span> pages <span class="keyword">then</span> $<span class="keyword">this</span>.addClass <span class="string">'disabled'</span>
        <span class="keyword">else</span> $<span class="keyword">this</span>.removeClass <span class="string">'disabled'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <p>Create and insert pagination links.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> pages <span class="keyword">isnt</span> children.length - <span class="number">2</span>
      children.remove()
      list = pagination.find <span class="string">'ul'</span>
      list.append $(<span class="string">'&lt;li/&gt;'</span>).append $ <span class="string">'&lt;a&gt;&amp;laquo;&lt;/a&gt;'</span>
      <span class="keyword">for</span> page <span class="keyword">in</span> [<span class="number">1.</span>.pages]
        list.append $(<span class="string">'&lt;li/&gt;'</span>).append $ <span class="string">"&lt;a&gt;<span class="subst">#{page}</span>&lt;/a&gt;"</span>
      list.append $(<span class="string">'&lt;li/&gt;'</span>).append $ <span class="string">'&lt;a&gt;&amp;raquo;&lt;/a&gt;'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <p>Bind event handlers to manage navigating pages.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    pagination.find(<span class="string">'ul li'</span>).<span class="literal">off</span> <span class="string">'click'</span>
    pagination.find(<span class="string">'ul li:first-child'</span>).<span class="literal">on</span> <span class="string">'click'</span>, -&gt;
      <span class="keyword">unless</span> $(<span class="keyword">this</span>).hasClass <span class="string">'disabled'</span>
        refreshPagination pagination.find(<span class="string">'ul li.active'</span>).index() - <span class="number">1</span>
    pagination.find(<span class="string">'ul li:not(:first-child, :last-child)'</span>).<span class="literal">on</span> <span class="string">'click'</span>, -&gt;
      $<span class="keyword">this</span> = $ <span class="keyword">this</span>
      refreshPagination $<span class="keyword">this</span>.index() <span class="keyword">unless</span> $<span class="keyword">this</span>.hasClass <span class="string">'active'</span>
    pagination.find(<span class="string">'ul li:last-child'</span>).<span class="literal">on</span> <span class="string">'click'</span>, -&gt;
      <span class="keyword">unless</span> $(<span class="keyword">this</span>).hasClass <span class="string">'disabled'</span>
        refreshPagination pagination.find(<span class="string">'ul li.active'</span>).index() + <span class="number">1</span>
    <span class="keyword">do</span> refreshPagination
    pagination.show()
  <span class="keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <p>Hide the pagination and remove all links as the results fit on a single page.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    pagination.hide().find(<span class="string">'ul li'</span>).remove()</pre></div></div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              <p>Update the state of the reset button depending on the current search input.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">refreshResetButton</span></span> = -&gt;
  log.trace()
  container   = $ <span class="string">'#order_search'</span>
  resetButton = container.find <span class="string">':reset'</span>
  <span class="keyword">if</span> container.find(<span class="string">':text'</span>).val()
    container.addClass <span class="string">'input-prepend'</span>
    resetButton.show()
  <span class="keyword">else</span>
    resetButton.hide()
    container.removeClass <span class="string">'input-prepend'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-97">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-97">&#182;</a>
              </div>
              <p>Update the state of certain buttons depending on whether any select boxes have been checked.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">refreshSelectButtons</span></span> = -&gt;
  log.trace()
  selections = $ <span class="string">'#orders tbody :checkbox:checked'</span>
  $(<span class="string">'#delete_btn'</span>).prop <span class="string">'disabled'</span>, selections.length <span class="keyword">is</span> <span class="number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-98">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-98">&#182;</a>
              </div>
              <p>Reset the wizard field values based on the current context.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">resetWizard</span></span> = -&gt;
  log.trace()
  activeOrder ?= {}
  $(<span class="string">'#order_wizard .modal-header h3'</span>).html <span class="keyword">if</span> activeOrder.key?
    i18n.get <span class="string">'opt_order_modify_title'</span>, activeOrder.label
  <span class="keyword">else</span>
    i18n.get <span class="string">'opt_order_new_header'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-99">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-99">&#182;</a>
              </div>
              <p>Assign values to their respective fields.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  $(<span class="string">'#order_code'</span>).val activeOrder.code <span class="keyword">or</span> <span class="string">''</span>
  $(<span class="string">'#order_label'</span>).val activeOrder.label <span class="keyword">or</span> <span class="string">''</span>
  $(<span class="string">'#order_number'</span>).val activeOrder.number <span class="keyword">or</span> <span class="string">''</span>
  $(<span class="string">'#order_delete_btn'</span>).each -&gt;
    $<span class="keyword">this</span> = $ <span class="keyword">this</span>
    <span class="keyword">if</span> activeOrder.key? <span class="keyword">then</span> $<span class="keyword">this</span>.show() <span class="keyword">else</span> $<span class="keyword">this</span>.hide()</pre></div></div>
            
        </li>
        
        
        <li id="section-100">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-100">&#182;</a>
              </div>
              <p>Search the orders for the specified <code>query</code> and filter those displayed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">searchOrders</span></span> = (query = <span class="string">''</span>) -&gt;
  log.trace()
  keywords = query.replace(R_CLEAN_QUERY, <span class="string">''</span>).split R_WHITESPACE
  <span class="keyword">if</span> keywords.length
    expression    = <span class="regexp">///
      <span class="comment">#{(keyword for keyword in keywords when keyword).join '|'}</span>
    ///</span>i
    searchResults = ext.queryOrders (order) -&gt;
      expression.test <span class="string">"<span class="subst">#{order.code}</span> <span class="subst">#{order.label}</span> <span class="subst">#{order.number}</span>"</span>
  <span class="keyword">else</span>
    searchResults = <span class="literal">null</span>
  loadOrderRows searchResults ? ext.orders
  <span class="keyword">do</span> refreshResetButton
  <span class="keyword">do</span> refreshSelectButtons</pre></div></div>
            
        </li>
        
        
        <li id="section-101">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-101">&#182;</a>
              </div>
              <p>Set the current context of the order wizard.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">setContext</span></span> = (order = {}) -&gt;
  log.trace()
  activeOrder = {}
  $.extend activeOrder, order
  <span class="keyword">do</span> resetWizard</pre></div></div>
            
        </li>
        
        
        <li id="section-102">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-102">&#182;</a>
              </div>
              <p>Convenient shorthand for safely trimming a string to lower case.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">trimToLower</span></span> = (str = <span class="string">''</span>) -&gt;
  str.trim().toLowerCase()</pre></div></div>
            
        </li>
        
        
        <li id="section-103">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-103">&#182;</a>
              </div>
              <p>Convenient shorthand for safely trimming a string to upper case.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">trimToUpper</span></span> = (str = <span class="string">''</span>) -&gt;
  str.trim().toUpperCase()</pre></div></div>
            
        </li>
        
        
        <li id="section-104">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-104">&#182;</a>
              </div>
              <h2>Options page setup</h2>

            </div>
            
        </li>
        
        
        <li id="section-105">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-105">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>options = window.options = <span class="keyword">new</span> <span class="class"><span class="keyword">class</span> <span class="title">Options</span> <span class="keyword">extends</span> <span class="title">utils</span>.<span class="title">Class</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-106">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-106">&#182;</a>
              </div>
              <h2>Public functions</h2>

            </div>
            
        </li>
        
        
        <li id="section-107">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-107">&#182;</a>
              </div>
              <p>Initialize the options page.<br>This will involve inserting and configuring the UI elements as well as loading the current
settings.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  init: -&gt;
    log.trace()
    log.info <span class="string">'Initializing the options page'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-108">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-108">&#182;</a>
              </div>
              <p>Add support for analytics if the user hasn&#39;t opted out.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    analytics.add() <span class="keyword">if</span> store.get <span class="string">'analytics'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-109">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-109">&#182;</a>
              </div>
              <p>Add the user feedback feature to the page.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">do</span> feedback</pre></div></div>
            
        </li>
        
        
        <li id="section-110">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-110">&#182;</a>
              </div>
              <p>Begin initialization.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    i18n.init()
    $(<span class="string">'.year-repl'</span>).html <span class="string">"<span class="subst">#{<span class="keyword">new</span> Date().getFullYear()}</span>"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-111">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-111">&#182;</a>
              </div>
              <p>Bind tab selection event to all tabs.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    initialTabChange = <span class="literal">yes</span>
    $(<span class="string">'a[tabify]'</span>).<span class="literal">on</span> <span class="string">'click'</span>, -&gt;
      target = $(<span class="keyword">this</span>).attr <span class="string">'tabify'</span>
      nav    = $ <span class="string">"#navigation a[tabify='<span class="subst">#{target}</span>']"</span>
      parent = nav.parent <span class="string">'li'</span>
      <span class="keyword">unless</span> parent.hasClass <span class="string">'active'</span>
        parent.siblings().removeClass <span class="string">'active'</span>
        parent.addClass <span class="string">'active'</span>
        $(target).show().siblings(<span class="string">'.tab'</span>).hide()
        id = nav.attr <span class="string">'id'</span>
        store.set <span class="string">'options_active_tab'</span>, id
        <span class="keyword">unless</span> initialTabChange
          id = id.match(<span class="regexp">/(\S*)_nav$/</span>)[<span class="number">1</span>]
          id = id[<span class="number">0</span>].toUpperCase() + id.substr <span class="number">1</span>
          log.debug <span class="string">"Changing tab to <span class="subst">#{id}</span>"</span>
          analytics.track <span class="string">'Tabs'</span>, <span class="string">'Changed'</span>, id
        initialTabChange = <span class="literal">no</span>
        $(document.body).scrollTop <span class="number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-112">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-112">&#182;</a>
              </div>
              <p>Reflect the persisted tab.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    store.init <span class="string">'options_active_tab'</span>, <span class="string">'general_nav'</span>
    optionsActiveTab = store.get <span class="string">'options_active_tab'</span>
    $(<span class="string">"#<span class="subst">#{optionsActiveTab}</span>"</span>).trigger <span class="string">'click'</span>
    log.debug <span class="string">"Initially displaying tab for <span class="subst">#{optionsActiveTab}</span>"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-113">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-113">&#182;</a>
              </div>
              <p>Bind Developer Tools wizard events to their corresponding elements.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $(<span class="string">'#tools_nav'</span>).<span class="literal">on</span> <span class="string">'click'</span>, -&gt;
      $(<span class="string">'#tools_wizard'</span>).modal <span class="string">'show'</span>
    $(<span class="string">'.tools_close_btn'</span>).<span class="literal">on</span> <span class="string">'click'</span>, -&gt;
      $(<span class="string">'#tools_wizard'</span>).modal <span class="string">'hide'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-114">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-114">&#182;</a>
              </div>
              <p>Ensure that form submissions don&#39;t reload the page.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $(<span class="string">'form:not([target="_blank"])'</span>).<span class="literal">on</span> <span class="string">'submit'</span>, -&gt; <span class="literal">no</span></pre></div></div>
            
        </li>
        
        
        <li id="section-115">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-115">&#182;</a>
              </div>
              <p>Bind analytical tracking events to key footer buttons and links.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $(<span class="string">'footer a[href*="neocotic.com"]'</span>).<span class="literal">on</span> <span class="string">'click'</span>, -&gt;
      analytics.track <span class="string">'Footer'</span>, <span class="string">'Clicked'</span>, <span class="string">'Homepage'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-116">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-116">&#182;</a>
              </div>
              <p>Setup and configure the donation button in the footer.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $(<span class="string">'#donation input[name="hosted_button_id"]'</span>).val ext.config.options.payPal
    $(<span class="string">'#donation'</span>).<span class="literal">on</span> <span class="string">'submit'</span>, -&gt;
      analytics.track <span class="string">'Footer'</span>, <span class="string">'Clicked'</span>, <span class="string">'Donate'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-117">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-117">&#182;</a>
              </div>
              <p>Load the current option values.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">do</span> load</pre></div></div>
            
        </li>
        
        
        <li id="section-118">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-118">&#182;</a>
              </div>
              <p>Initialize all popovers, tooltips and <em>go-to</em> links.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $(<span class="string">'[popover]'</span>).each -&gt;
      $<span class="keyword">this</span>     = $ <span class="keyword">this</span>
      placement = $<span class="keyword">this</span>.attr <span class="string">'data-placement'</span>
      placement = <span class="keyword">if</span> placement? <span class="keyword">then</span> trimToLower placement <span class="keyword">else</span> <span class="string">'right'</span>
      trigger   = $<span class="keyword">this</span>.attr <span class="string">'data-trigger'</span>
      trigger   = <span class="keyword">if</span> trigger? <span class="keyword">then</span> trimToLower trigger <span class="keyword">else</span> <span class="string">'hover'</span>
      $<span class="keyword">this</span>.popover
        content:   -&gt; i18n.get $<span class="keyword">this</span>.attr <span class="string">'popover'</span>
        html:      <span class="literal">yes</span>
        placement: placement
        trigger:   trigger
      <span class="keyword">if</span> trigger <span class="keyword">is</span> <span class="string">'manual'</span>
        $<span class="keyword">this</span>.<span class="literal">on</span> <span class="string">'click'</span>, -&gt;
          $<span class="keyword">this</span>.popover <span class="string">'toggle'</span>
    <span class="keyword">do</span> activateTooltips
    navHeight = $(<span class="string">'.navbar'</span>).height()
    $(<span class="string">'[data-goto]'</span>).<span class="literal">on</span> <span class="string">'click'</span>, -&gt;
      goto = $ $(<span class="keyword">this</span>).attr <span class="string">'data-goto'</span>
      pos  = goto.position()?.top <span class="keyword">or</span> <span class="number">0</span>
      pos -= navHeight <span class="keyword">if</span> pos <span class="keyword">and</span> pos &gt;= navHeight
      log.debug <span class="string">"Relocating view to include '<span class="subst">#{goto.selector}</span>' at <span class="subst">#{pos}</span>"</span>
      $(window).scrollTop pos</pre></div></div>
            
        </li>
        
        
        <li id="section-119">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-119">&#182;</a>
              </div>
              <p>Ensure that the persisted tab is currently visible.<br>This should be called if the user clicks the Options link in the popup while and options page
is already open.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  refresh: -&gt;
    $(<span class="string">"#<span class="subst">#{store.get 'options_active_tab'}</span>"</span>).trigger <span class="string">'click'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-120">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-120">&#182;</a>
              </div>
              <p>Initialize <code>options</code> when the DOM is ready.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>utils.ready -&gt; options.init()</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
